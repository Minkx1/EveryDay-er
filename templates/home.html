<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>EveryDay'er</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="content">
        <h1 class="title">EveryDay'er</h1>
        <div class="date-info">–°—å–æ–≥–æ–¥–Ω—ñ: {{ current_date }}</div>

        <h2 class="section-title">–ü–ª–∞–Ω–∏ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</h2>
        <div class="week">
            {% for day, events in week_plans.items() %}
                <div class="day">
                    <h3>{{ day.capitalize() }}</h3>
                    <button class="add-btn" data-day="{{ day }}">‚ûï –î–æ–¥–∞—Ç–∏ –ø–æ–¥—ñ—é</button>
                    {% if events %}
                        {% for e in events %}
                            <div class="event">
                                <span class="event-name">{{ e.name }}</span>
                                <span class="event-time">{{ e.time }}</span>
                                <div class="event-actions">
                                    <button class="edit-btn" data-index="{{ loop.index0 }}" data-day="{{ day }}">‚úè –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                    <button class="delete-btn" data-day="{{ day }}" data-index="{{ loop.index0 }}">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-events">–ù–µ–º–∞—î –ø–ª–∞–Ω—ñ–≤</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

        <h2 class="section-title">–ü–ª–∞–Ω–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∞—Ç–∏</h2>
        <div class="add-day-wrapper">
            <button id="addDayBtn" class="add-day-btn">‚ûï –î–æ–¥–∞—Ç–∏ –¥–µ–Ω—å</button>
        </div>
        <div class="week">
            {% for date, events in date_plans.items() %}
                <div class="day special">
                    <h3>{{ date }}</h3>
                    <button class="add-btn" data-day="{{ date }}">‚ûï –î–æ–¥–∞—Ç–∏ –ø–æ–¥—ñ—é</button>
                    <button class="delete-day-btn" data-day="{{ date }}">üóë –í–∏–¥–∞–ª–∏—Ç–∏ –¥–µ–Ω—å</button>
                    {% if events %}
                        {% for e in events %}
                            <div class="event">
                                <span class="event-name">{{ e.name }}</span>
                                <span class="event-time">{{ e.time }}</span>
                                <div class="event-actions">
                                    <button class="edit-btn" data-index="{{ loop.index0 }}" data-day="{{ date }}">‚úè –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                    <button class="delete-btn" data-day="{{ date }}" data-index="{{ loop.index0 }}">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-events">–ù–µ–º–∞—î –ø–ª–∞–Ω—ñ–≤</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—é</h3>
            <form id="editForm" method="post" action="/edit_event">
                <input type="hidden" name="day" id="editDay">
                <input type="hidden" name="index" id="editIndex">
                <input type="text" name="name" id="editName" placeholder="–ù–∞–∑–≤–∞ –ø–æ–¥—ñ—ó" required>
                <input type="text" name="time" id="editTime" placeholder="–ß–∞—Å" required>
                <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–î–æ–¥–∞—Ç–∏ –ø–æ–¥—ñ—é</h3>
            <form id="addEventForm" method="post" action="/add_event">
                <input type="hidden" name="day" id="addDay">
                <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞ –ø–æ–¥—ñ—ó" required>
                <input type="text" name="time" placeholder="–ß–∞—Å" required>
                <button type="submit">–î–æ–¥–∞—Ç–∏</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–Ω—è -->
    <div id="addDayModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –¥–µ–Ω—å</h3>
            <form id="addDayForm" method="post" action="/add_day">
                <input type="text" name="date" placeholder="DD.MM.YYYY" required>
                <button type="submit">–î–æ–¥–∞—Ç–∏ –¥–µ–Ω—å</button>
            </form>
        </div>
    </div>

    <script>
        // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ç–∞ –∑–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–æ–∫
        const editModal = document.getElementById("editModal");
        const addEventModal = document.getElementById("addEventModal");
        const addDayModal = document.getElementById("addDayModal");

        // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
        document.querySelectorAll(".edit-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
                const eventDiv = e.target.closest(".event");
                document.getElementById("editName").value = eventDiv.querySelector(".event-name").innerText;
                document.getElementById("editTime").value = eventDiv.querySelector(".event-time").innerText;
                const dayDiv = eventDiv.closest(".day");
                document.getElementById("editDay").value = btn.dataset.day;   // –±–µ—Ä–µ–º–æ –∑ data-day –∫–Ω–æ–ø–∫–∏
                document.getElementById("editIndex").value = btn.dataset.index; // –±–µ—Ä–µ–º–æ –∑ data-index –∫–Ω–æ–ø–∫–∏
                editModal.style.display = "block";
            });
        });

        // –í–∏–¥–∞–ª–µ–Ω–Ω—è
        document.querySelectorAll(".delete-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
                const day = btn.dataset.day;
                const index = btn.dataset.index;

                fetch("/delete_event", {
                    method: "POST",
                    headers: {"Content-Type": "application/x-www-form-urlencoded"},
                    body: `day=${encodeURIComponent(day)}&index=${encodeURIComponent(index)}`
                }).then(() => location.reload());
            });
        });

        // –î–æ–¥–∞—Ç–∏ –ø–æ–¥—ñ—é
        document.querySelectorAll(".add-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
                document.getElementById("addDay").value = btn.dataset.day;
                addEventModal.style.display = "block";
            });
        });

        // –î–æ–¥–∞—Ç–∏ –¥–µ–Ω—å
        document.getElementById("addDayBtn").addEventListener("click", () => {
            addDayModal.style.display = "block";
        });

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–æ–∫
        document.querySelectorAll(".close").forEach((el) => {
            el.addEventListener("click", () => {
                el.closest(".modal").style.display = "none";
            });
        });

        window.addEventListener("click", (e) => {
            if (e.target.classList.contains("modal")) {
                e.target.style.display = "none";
            }
        });
        document.querySelectorAll(".delete-day-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
                const day = btn.dataset.day;
                fetch("/delete_day", {
                    method: "POST",
                    headers: {"Content-Type": "application/x-www-form-urlencoded"},
                    body: `day=${encodeURIComponent(day)}`
                }).then(() => location.reload());
            });
        });
    </script>
</body>
</html>
